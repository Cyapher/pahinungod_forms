{% extends 'base_dashboard.html' %}

{% block body %}

<style>

    body {
        zoom: 90%;
    }

    th {
        width: 100%;
    }

    #navigation {
        background-color: #7B0100;
    }

    #filterRow {
        background-color: #ffffff;
    }

    .btn_width {
        width: 160px;
    }

    .button-grid {
    display: grid;
    grid-template-columns: auto auto;
    gap: 20px;
    justify-content: center;
    /* align-items: center; */
    /* position: absolute; */
    top: 50%;
    /* left: 50%; */
    /* transform: translate(-50%, -50%); */
  }

  .btn_width_act {
    width: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    /* position: absolute; */
    top: 50%;
    /* left: 50%; */
    /* transform: translate(50%, -50%); */

    
}

    table {
        table-layout:auto;
    }
    

    .sticky-thead {
    position: sticky;
    top: 0;
    z-index: 1;
    background-color: #532222; /* Light gray background */
}

    .accordion-button::after {
    display: none !important;

    .unclickable {
    pointer-events: none;
    }
}
  td {
    font-size: medium;
  }

  .scrollable-content {
    max-height: 200px;
    overflow-y: auto;
  } 

  .programWidth {
    width:20%;
    max-width: 20px;
  }

  .dateFilter-block {
    width: 100%;
    max-width: 200px;
    margin-right: 30px;
  }

  .sortable {
    user-select: none;
  }

  .sortable:hover {
    cursor: pointer;
  }

</style>
      
      <div class="collapse" id="navbarToggleExternalContent" style="width: 110%;">
        <div class="p-4">
            <nav id="filterRow" class="navbar navbar-expand-lg">
                <div class="container">
                    <form class="d-flex" action="{% url 'filter_vol' %}" method="get">
                        {% if request.GET.start %}
                        <input name="start" class="form-control me-6 mx-2" type="date" placeholder="mm/dd/yyyy" value="{{ request.GET.start }}">
                        {% else %}
                        <input name="start" class="form-control me-6 mx-2" type="date" placeholder="mm/dd/yyyy">
                        {% endif %}
                        {% if request.GET.end %}
                        <input name="end" class="form-control me-6 mx-2" type="date" placeholder="mm/dd/yyyy" value="{{ request.GET.end }}">
                        {% else %}
                        <input name="end" class="form-control me-6 mx-2" type="date" placeholder="mm/dd/yyyy">
                        {% endif %}
                        <button type="submit" class="btn btn-dark" style="width: 140%;">
                            Filter Date Range  <i class="fa-regular fa-calendar"></i>
                        </button>
                        <select class="form-select me-6 mx-2" name="column">
                            <option {% if request.GET.column == 'first_name' %}selected{% endif %} value="first_name">Name</option>
                            <option {% if request.GET.column == 'customStartDate' %}selected{% endif %} value="customStartDate">Start Date</option>
                            <option {% if request.GET.column == 'occupation' %}selected{% endif %} value="occupation">Occupation</option>
                        </select>
                        <select class="form-select me-6 mx-2" name="order">
                            <option {% if request.GET.order == 'asc' %}selected{% endif %} value="asc">A-Z/Old-New</option>
                            <option {% if request.GET.order == 'des' %}selected{% endif %} value="des">Z-A/New-Old</option>
                        </select>
                        <button type="submit" class="btn btn-dark" style="width: 100%;">
                            Sort  <i class="fa-solid fa-sort"></i>
                        </button>
                        {% if request.GET.q %}
                        <input name="q" class="form-control me-6 mx-2" type="search" placeholder="Search" aria-label="Search" value="{{ request.GET.q }}" style="width: 140%;">
                        {% else %}
                        <input name="q" class="form-control me-6 mx-2" type="search" placeholder="Search" aria-label="Search" style="width: 140%;">
                        {% endif %}
                        <button type="submit" class="btn btn-dark" style="width: 100%;">
                            Search  <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </form>
                </div>
            </nav>
        </div>
    </div>
    
    

      <nav class="navbar navbar-expand">
        <div class="container-fluid justify-content-between">
          <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-label="Toggle navigation">
            Sort/Filter
          </button>
          <form action="{% url 'list' %}">
              <input class="btn btn-dark" type="submit" value="Reset Filters">
          </form>
        </div>
      </nav>
      


  <br>
  {% if volunteers %}
  <div align="center">
    <table id="volunteer_list" class="table table-bordered w-75">
        <thead class="table-light border-dark">
            <th style="width: 15%; max-width: 10px;">Name</th>
            <th style="width: 35%; max-width: 250px;">Specific Information</th>
            <th class="programWidth">Programs</th>
            <th style="width: 10%; max-width: 10px;">Start Date</th>
            <th style="width: 5%; max-width: 10px;">Occupation</th>
            <th style="text-align: center;">Actions</th>

        </thead>
        <tbody id="accordionExample" class="border-dark">
            {% for volunteer in volunteers %}
            <tr>
                <td style="width: 15%; max-width: 10px; word-break: break-word;">
                    <strong>
                        {{volunteer.first_name}} {{volunteer.last_name}}
                    </strong>
                </td>
                <td style="width: 35%; max-width: 250px;">
                    <div class="accordion my-3">
                        <div class="">
                            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                <div align="center" class="accordion-body collapsed">
                                    <div class="button-grid" align="center">
                                            <form action="" title="Volunteer Information">
                                                {% csrf_token %}
                                                <input id="btn_Vol{{ forloop.counter }}" type="button" class="btn btn-outline-success btn-sm btn_width" value="Volunteer Info" data-bs-toggle="collapse" data-bs-target="#collapse_vol{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}" onclick="loadContent('{{ volunteer.id }}', '{{forloop.counter}}', this.id)">
                                            </form>
                                            <form action="" title="License Information">
                                                {% csrf_token %}
                                                <input id="btn_Lic{{ forloop.counter }}" type="button" class="btn btn-outline-success btn-sm btn_width" value="License/Work Info" data-bs-toggle="collapse" data-bs-target="#collapse_lic{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}" onclick="loadContent('{{ volunteer.id }}', '{{forloop.counter}}', this.id)">
                                            </form>
                                            <form action="" title="Insurance Information">
                                                {% csrf_token %}
                                                <input id="btn_Ins{{ forloop.counter }}" type="button" class="btn btn-outline-success btn-sm btn_width" value="Insurance Info" data-bs-toggle="collapse" data-bs-target="#collapse_ins{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}" onclick="loadContent('{{ volunteer.id }}', '{{forloop.counter}}', this.id)">
                                            </form>
                                            <form action="" title="Student Information">
                                                {% csrf_token %}
                                                <input id="btn_Stu{{ forloop.counter }}" type="button" class="btn btn-outline-success btn-sm btn_width" value="Student Info" data-bs-toggle="collapse" data-bs-target="#collapse_stu{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse{{ forloop.counter }}" onclick="loadContent('{{ volunteer.id }}', '{{forloop.counter}}', this.id)">
                                            </form>
                                    </div>
                                </div>
                            </h2>
                            <div id="collapse_vol{{ forloop.counter }}" class="accordion-collapse collapse scrollable-content" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="accordionContent_vol{{ forloop.counter }}">                                    
                                </div>
                            </div>
                            <div id="collapse_lic{{ forloop.counter }}" class="accordion-collapse collapse scrollable-content" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="accordionContent_lic{{ forloop.counter }}">                                    
                                </div>
                            </div>
                            <div id="collapse_ins{{ forloop.counter }}" class="accordion-collapse collapse scrollable-content" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="accordionContent_ins{{ forloop.counter }}">                                    
                                </div>
                            </div>
                            <div id="collapse_stu{{ forloop.counter }}" class="accordion-collapse collapse scrollable-content" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#accordionExample">
                                <div class="accordion-body" id="accordionContent_stu{{ forloop.counter }}">                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td class="programWidth">
                    {% for program in volunteer.programs.all %}
                                <strong>
                                    <li>
                                        ({{ program.code }}) {{ program.name }}
                                    </li>
                                </strong>
                    {% endfor %}   
                </td>
                <td style="width: 10%; max-width: 10px;">
                    {{ volunteer.customStartDate }}
                </td>
                <td style="width: 10%; max-width: 10px;">
                    {% if volunteer.occupation == "Other" %}
                    
                    {{ volunteer.otherOccu }}
                    
                    {% else %}
                    
                    {{ volunteer.occupation }}
                    
                    {% endif %}
                </td>
                <td align="center">
                    <!-- Edit -->
                    <h2>
                        <div class="my-5">
                            <form action="{% url 'edit' volunteer.id %}" style="margin-bottom: 5px;">
                                <input type="submit" class="btn btn-outline-secondary btn-sm btn_width_act" value="Edit">
                            </form>
                        <!-- Delete -->
                            <form action="{% url 'del_volunteer' volunteer.id %}">
                                <input type="submit" class="btn btn-outline-danger btn-sm btn_width_act" value="Delete" onclick="return confirm('Are you sure?');" style="transform: translateY(10px);">
                            </form>
                        </div>
                    </h2>
                </td>
            </tr>
            
            {% endfor %}
        </tbody>
    </table>
    </div>
    
    <div class="container text-center mt-3">
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if volunteers.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1" aria-label="First">
                            <span aria-hidden="true">&laquo; First</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ volunteers.previous_page_number }}" aria-label="Previous">
                            <span aria-hidden="true">&lsaquo; Previous</span>
                        </a>
                    </li>
                {% endif %}
    
                <li class="page-item disabled">
                    <span class="page-link">
                        Page {{ volunteers.number }} of {{ volunteers.paginator.num_pages }}.
                    </span>
                </li>
    
                {% if volunteers.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ volunteers.next_page_number }}" aria-label="Next">
                            <span aria-hidden="true">Next &rsaquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ volunteers.paginator.num_pages }}" aria-label="Last">
                            <span aria-hidden="true">Last &raquo;</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        <p class="mt-3">Showing {{ volunteers.start_index }} - {{ volunteers.end_index }} out of {{ volunteers.paginator.count }} rows</p>
    </div>
{% else %}

<h2 class="display-2" align="center">No entries.</h2>
<h6 class="display-6" align="center">lmao</h6>

{% endif %}



<script>    
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
})

    var prevButton = "";

    function loadContent(volunteerId, counter, btn_id) {

        infoType = "/info";
        content_ver = "Vol";

        if (btn_id.includes("btn_Vol")) {
            infoType = "/info";
            content_ver = "vol";
        } else if (btn_id.includes("btn_Lic")) {
            infoType = "/license";
            content_ver = "lic";
        } else if (btn_id.includes("btn_Ins")) {
            infoType = "/insurance";
            content_ver = "ins";
        } else if (btn_id.includes("btn_Stu")) {
            infoType = "/student";
            content_ver = "stu";
        }

        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {

                    var accordionContent = document.getElementById('accordionContent_' + content_ver + counter);
                    var currentDisplay = accordionContent.style.display;
                    
                    // Close the accordion body if it's already open
                    if (currentDisplay === 'block') {
                        accordionContent.style.display = 'none';
                    }
                    
                    // Open the accordion body again to display the information
                    accordionContent.innerHTML = xhr.responseText;
                    accordionContent.style.display = 'block';
                } else {
                    console.error('Failed to load content: ' + xhr.status);
                }
            }
        };

        // Construct the URL with the volunteer id
        xhr.open('GET', '/volunteer/' + volunteerId + infoType, true);
        xhr.send();
    }



</script>

{% endblock %}